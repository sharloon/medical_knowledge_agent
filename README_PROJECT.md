# åŒ»ç–—çŸ¥è¯†åŠ©æ‰‹æ™ºèƒ½ä½“

åŸºäº RAG å’Œæ™ºèƒ½ä½“æŠ€æœ¯çš„ç³–å°¿ç—…/é«˜è¡€å‹è¯Šæ–­åŒ»ç–—åŠ©æ‰‹

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªé›†æˆå¤šæºæ•°æ®çš„åŒ»ç–—å†³ç­–æ”¯æŒç³»ç»Ÿï¼Œæ•´åˆ PDF æŒ‡å—æ–‡æ¡£ã€Excel ç»Ÿè®¡æ•°æ®å’Œ MySQL æ•°æ®åº“ï¼Œå®ç°ä¸´åºŠè¯Šç–—å…¨æµç¨‹å†³ç­–æ”¯æŒã€‚

## åŠŸèƒ½ç‰¹æ€§

### åŸºç¡€æ•°æ®å±‚ (25åˆ†)
- âœ… PDF çŸ¥è¯†åº“æ„å»ºï¼šæå–æ–‡æ¡£ç›®å½•ç»“æ„åŠå…³é”®è¡¨æ ¼
- âœ… æœ¯è¯­æ ‡å‡†åŒ–æ˜ å°„ï¼šæ”¯æŒ"å¿ƒæ¢—"â†’"å¿ƒè‚Œæ¢—æ­»"ç­‰åŒ»å­¦æœ¯è¯­æ˜ å°„
- âœ… Excel æ•°æ®å¤„ç†ï¼šè§£æç³–å°¿ç—…ç—…ä¾‹ç»Ÿè®¡ä¸­çš„èƒ°å²›ç´ ä½¿ç”¨ç‡åˆ†å¸ƒ
- âœ… å¤šæ¨¡æ€æ•°æ®æ•´åˆï¼šPDF+Excel+MySQL ç»Ÿä¸€æ£€ç´¢æ¥å£
- âœ… æŒ‡å—æ—¶æ•ˆæ€§éªŒè¯ï¼šæŒ‰æ›´æ–°æ—¥æœŸè¿‡æ»¤æŒ‡å—æ–‡æ¡£
- âœ… æ™ºèƒ½å¯¹è¯ï¼šæœ‰/æ— çŸ¥è¯†åº“æ—¶çš„ä¸“ä¸šå›å¤
- âœ… å®šæ—¶ç´¢å¼•æ›´æ–°ï¼šæ¯2åˆ†é’Ÿè‡ªåŠ¨é‡å»ºç´¢å¼•

### ä¸“å®¶æ™ºèƒ½ä½“æ ¸å¿ƒèƒ½åŠ› (55åˆ†)
- âœ… æ‚£è€…ç”»åƒæ„å»ºï¼šè¾“å…¥æ‚£è€…IDè‡ªåŠ¨ç”Ÿæˆå®Œæ•´ç”»åƒ
- âœ… é£é™©åˆ†å±‚è¯„ä¼°ï¼šåŸºäºæŒ‡å—çš„é«˜è¡€å‹/ç³–å°¿ç—…é£é™©è¯„ä¼°
- âœ… ç”¨è¯å†²çªæ£€æµ‹ï¼šè¯ç‰©ç¦å¿Œå’Œç›¸äº’ä½œç”¨é¢„è­¦
- âœ… è¯Šæ–­æ¨ç†ï¼šç”Ÿæˆâ‰¥3ä¸ªé‰´åˆ«è¯Šæ–­åŠæ¦‚ç‡æ’åº
- âœ… æ²»ç–—æ–¹æ¡ˆç”Ÿæˆï¼šä¸ªæ€§åŒ–æ–¹æ¡ˆ+è¯æ®ç­‰çº§æ ‡æ³¨
- âœ… åŠ¨æ€è°ƒæ•´ï¼šç–—æ•ˆä¸ä½³æ—¶çš„æ–¹æ¡ˆè°ƒæ•´
- âœ… è¯æ®ç­‰çº§æ ‡æ³¨ï¼šâ… Aã€â… Bã€â…¡Aç­‰çº§åˆ«
- âœ… é«˜é£é™©é¢„è­¦ï¼šå­•å¦‡ACEI/ARBç¦å¿Œé¢„è­¦
- âœ… è½¬è¯Šå†³ç­–ï¼šé«˜è¡€å‹æ€¥ç—‡(SBP>180)ç´§æ€¥è½¬è¯Šå»ºè®®

### ç³»ç»Ÿå·¥ç¨‹èƒ½åŠ› (20åˆ†)
- âœ… SOAPæ ¼å¼ç»“æ„åŒ–é—®è¯Š
- âœ… ä¿¡æ¯æ¾„æ¸…èƒ½åŠ›
- âœ… å¼‚å¸¸å¤„ç†ä¸ä¼˜é›…é™çº§
- âœ… å†³ç­–æº¯æºï¼šæ ‡æ³¨æ•°æ®æ¥æº

## æŠ€æœ¯æ¶æ„

```
â”œâ”€â”€ app.py                 # Flask åº”ç”¨å…¥å£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config.py          # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ llm_client.py      # LLM å®¢æˆ·ç«¯ (ç™¾ç‚¼ API)
â”‚   â”œâ”€â”€ db_client.py       # MySQL æ•°æ®åº“å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ data_ingest.py     # æ•°æ®æ‘„å– (PDF/Excel)
â”‚   â”œâ”€â”€ vector_store.py    # å‘é‡å­˜å‚¨ (LlamaIndex)
â”‚   â”œâ”€â”€ term_mapper.py     # æœ¯è¯­æ˜ å°„
â”‚   â”œâ”€â”€ rag_service.py     # RAG æ£€ç´¢æœåŠ¡
â”‚   â”œâ”€â”€ risk_engine.py     # é£é™©è¯„ä¼°å¼•æ“
â”‚   â”œâ”€â”€ safety_guard.py    # å®‰å…¨é¢„è­¦æ¨¡å—
â”‚   â”œâ”€â”€ medical_agent.py   # åŒ»ç–—æ™ºèƒ½ä½“æ ¸å¿ƒ
â”‚   â””â”€â”€ scheduler.py       # å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html         # å‰ç«¯é¡µé¢
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/style.css      # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ js/app.js          # å‰ç«¯é€»è¾‘
â”œâ”€â”€ data/                  # æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ é«˜è¡€å‹è¯Šç–—æŒ‡å—.pdf
â”‚   â”œâ”€â”€ ä¸­å›½é«˜è¡€å‹é˜²æ²»æŒ‡å—.pdf
â”‚   â””â”€â”€ ç³–å°¿ç—…ç—…ä¾‹ç»Ÿè®¡.xlsx
â””â”€â”€ db/
    â”œâ”€â”€ ddl.sql            # æ•°æ®åº“å»ºè¡¨è¯­å¥
    â””â”€â”€ data.sql           # æµ‹è¯•æ•°æ®
```

## å®‰è£…éƒ¨ç½²

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# Windows PowerShell
$env:DASHSCOPE_API_KEY="your-api-key"

# Linux/Mac
export DASHSCOPE_API_KEY="your-api-key"
```

### 3. å¯åŠ¨æœåŠ¡

```bash
python app.py
```

æœåŠ¡å°†åœ¨ http://localhost:5000 å¯åŠ¨

## API æ¥å£

### æ™ºèƒ½å¯¹è¯
```
POST /api/chat
Body: {"message": "æŸ¥è¯¢æ‚£è€…ID=1002_0_20210504", "patient_id": "1002_0_20210504"}
```

### æ‚£è€…ç”»åƒ
```
GET /api/patient/{patient_id}
```

### é£é™©è¯„ä¼°
```
GET /api/patient/{patient_id}/risk-assessment
```

### è·¨æºæ£€ç´¢
```
POST /api/search
Body: {"query": "é«˜è¡€å‹æ€¥ç—‡å¤„ç†", "filters": {"update_date_after": "2023-01-01"}}
```

### æŒ‡å—æŸ¥è¯¢
```
GET /api/guidelines?disease_type=é«˜è¡€å‹&update_date_after=2023-01-01
```

### æœ¯è¯­æ˜ å°„
```
GET /api/term-mapping
POST /api/term-normalize
Body: {"term": "å¿ƒæ¢—"}
```

### èƒ°å²›ç´ åˆ†æ
```
GET /api/insulin-analysis
```

### ç´¢å¼•ç®¡ç†
```
GET /api/index/status
POST /api/index/rebuild
```

## æµ‹è¯•æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šæ‚£è€…ç”»åƒä¸æ–¹æ¡ˆç”Ÿæˆ
```
è¾“å…¥: æŸ¥è¯¢æ‚£è€…ID=1002_0_20210504
æœŸæœ›è¾“å‡º:
- 58å²ç”·æ€§ï¼ŒBMI 28.5
- è¡€å‹ 168/98mmHgï¼Œ2çº§é«˜è¡€å‹
- åˆå¹¶2å‹ç³–å°¿ç—…ï¼ŒHbA1c 8.2%
- å½“å‰ç”¨è¯ï¼šæ°¨æ°¯åœ°å¹³ 5mg qd
- è”åˆé™å‹æ–¹æ¡ˆ+è¡€ç³–æ§åˆ¶å»ºè®®+3ä¸ªæœˆéšè®¿è®¡åˆ’
```

### æ¡ˆä¾‹2ï¼šå­•å¦‡ç”¨è¯ç¦å¿Œ
```
è¾“å…¥: 35å²å­•å¦‡ï¼Œè¡€å‹158/96mmHgçš„æ²»ç–—æ–¹æ¡ˆ
æœŸæœ›è¾“å‡º:
- âš ï¸ ç¦ç”¨ACEI/ARBé¢„è­¦
- æ¨èç”²åŸºå¤šå·´æˆ–æ‹‰è´æ´›å°”
- å»ºè®®äº§ç§‘ä¼šè¯Š
```

### æ¡ˆä¾‹3ï¼šé«˜è¡€å‹æ€¥ç—‡
```
è¾“å…¥: æ”¶ç¼©å‹190mmHgï¼Œå¤´ç—›å‘•å3å°æ—¶
æœŸæœ›è¾“å‡º:
- ğŸš¨ è¯†åˆ«ä¸ºé«˜è¡€å‹æ€¥ç—‡
- å»ºè®®ç«‹å³é™è„‰é™å‹
- è¦æ±‚ç´§æ€¥è½¬è¯Šè‡³æ€¥è¯Šç§‘
- å±•ç¤ºæŒ‡å—æ¨è
```

## æ•°æ®åº“é…ç½®

```
Host: rm-bp1y35g510t57uexqlo.mysql.rds.aliyuncs.com
Port: 3306
User: logcloud
Password: Logcloud4321
Database: medical_knowledge_base
```

## æŠ€æœ¯æ ˆ

- **åç«¯**: Python 3.10+, Flask
- **LLM**: é˜¿é‡Œäº‘ç™¾ç‚¼ (qwen-plus) via OpenAI SDK
- **RAG**: LlamaIndex + DashScope Embedding
- **æ•°æ®åº“**: MySQL 8.0
- **å‰ç«¯**: HTML5 + CSS3 + JavaScript

## æ—¥å¿—

ç³»ç»Ÿä¼šè®°å½•ä»¥ä¸‹å…³é”®æ“ä½œï¼š
- LLM è°ƒç”¨æ—¥å¿—
- RAG æ£€ç´¢æ“ä½œ
- æ•°æ®åº“æŸ¥è¯¢ (å« SQL)
- ç´¢å¼•æ›´æ–°æ—¶é—´æˆ³

æ—¥å¿—æ–‡ä»¶ä½ç½®: `logs/medical_agent.log`

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ç”¨äºæ•™å­¦æ¼”ç¤ºç›®çš„ã€‚

